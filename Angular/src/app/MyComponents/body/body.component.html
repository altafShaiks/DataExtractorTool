<div class="page-search-pagination search">
    <form [formGroup]="searchForm" class="serachBar">
        <div class="input-group search-bar">
            <div class="input-group-prepend">
                <span class="input-group-text" id=""><fa-icon class="user-icon"
                        [icon]="faMagnifyingGlass"></fa-icon></span>
            </div>

            <input type="text" class="searchBarInput form-control" placeholder="Search user by Id"
                formControlName="searchValue" (ngModelChange)="onSearchSubmit()">
        </div>
    </form>
</div>
<div class="page-search-pagination pagination">
    <mat-paginator [length]="users.length" [pageSize]="pageSize" [showFirstLastButtons]="true"
        [pageSizeOptions]="[15, 20, 25]" [pageIndex]="currentPage" (page)="handlePageEvent($event)">
    </mat-paginator>
</div>

<div class="container-fluid">
    <div class="user-details-table">
        <div class="checkbox-arrows">
            <input type="checkbox" class="page-head" id="head-checkbox" [(ngModel)]="isCheckedAll"
                (change)="toggleAllCheckboxes()">
            <fa-icon class="add-user-icon" [icon]="faSquarePlus" [ngClass]="{'disabled': isAddUserIconDisabled}"
                [attr.data-bs-toggle]="isAddUserIconDisabled ? null : 'modal'"
                [attr.data-bs-target]="isAddUserIconDisabled ? null : '#addUserModal'">
            </fa-icon>

            <fa-icon class="delete-all-user-icon" [icon]="faTrash"
                [attr.data-bs-toggle]="getBsToggle()['data-bs-toggle']"
                [attr.data-bs-target]="getBsTarget()['data-bs-target']" (click)="setUserToDelete('')"></fa-icon>
        </div>
        <div *ngIf="getPaginatedUsers().length >= 1 else elseBlock">
            <h1 class="user-details-heading">Users Details</h1>


            <div class="all-entry">
                <div class="container-fluid">
                    <div class="row single-entry" [ngClass]="{'selected-entry': user.isChecked}"
                        *ngFor="let user of getPaginatedUsers()">
                        <div class="col-1 checkbox-column">
                            <input type="checkbox" class="checkbox-entry" [attr.id]="user.user_id"
                                [(ngModel)]="user.isChecked" (change)="checkEntryForCheckedbox(user)">
                        </div>
                        <div class="col-11 user-data">
                            <div class="row" style="margin: auto;">
                                <div class="col-3" (click)="showUserDetails(user.user_id)">
                                    {{user.user_id}}
                                </div>
                                <div class="col-8" (click)="showUserDetails(user.user_id)">
                                    {{ user.first_name }} {{ user.last_name }}
                                </div>
                                <div class="col-1">
                                    <div class="row">
                                        <div class="col-6">
                                            <fa-icon class="update-user-icon" [attr.id]="user.user_id" [icon]="faPen"
                                                (click)="patchValue(user.user_id)" data-bs-toggle="modal"
                                                data-bs-target="#updateUserModal" [ngClass]="{'disabled': isAddUserIconDisabled}"></fa-icon>
                                        </div>
                                        <div class="col-6">
                                            <fa-icon class="delete-user-icon" [icon]="faTrash"
                                                (click)="setUserToDelete(user)" data-bs-toggle="modal"
                                                data-bs-target="#confirmDeleteUserModal" [ngClass]="{'disabled': isAddUserIconDisabled}"></fa-icon>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr>
                    </div>
                </div>
            </div>
        </div>
        <ng-template #elseBlock>
            <div class="user-not-found">
                <h1>Sorry! User Not Found ðŸ˜”</h1>
            </div>
        </ng-template>
    </div>





    <!-- Modal for adding new User -->
    <div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Add New User (Insert into Database)</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form #usersForm="ngForm" (ngSubmit)="getFormData(usersForm.value)">
                        <div class="mb-3">
                            <label for="" class="form-label">User Id</label>
                            <input type="text" name="user_id" ngModel class="form-control" id="userId">
                        </div>
                        <div class="mb-3">
                            <label for="" class="form-label">First Name</label>
                            <input type="text" name="first_name" ngModel class="form-control" id="firstName">
                        </div>
                        <div class="mb-3">
                            <label for="" class="form-label">Last Name</label>
                            <input type="text" name="last_name" ngModel class="form-control" id="lastName">
                        </div>
                        <div class="mb-3">
                            <label for="" class="form-label">Date of Birth (DOB)</label>
                            <input id="dob" class="form-control" type="date" name="dob" ngModel placeholder="YYYY-MM-DD"
                                required>

                        </div>
                        <div class="mb-3">
                            <label for="" class="form-label">Gender</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="gender" ngModel id="male"
                                    value="male">
                                <label class="form-check-label" for="male">
                                    Male
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="gender" ngModel id="female"
                                    value="female">
                                <label class="form-check-label" for="female">
                                    Female
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="gender" ngModel id="others"
                                    value="others">
                                <label class="form-check-label" for="others">
                                    Others
                                </label>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="" class="form-label">Country</label>
                            <input type="text" name="country" ngModel class="form-control" id="country">
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-primary" data-bs-dismiss="modal">Add</button>
                        </div>
                    </form>
                </div>

            </div>
        </div>
    </div>

    <!-- Modal for updating User -->
    <div class="modal fade" id="updateUserModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Update User (Edit into Database)</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form [formGroup]="updateUserFormValue" #updateUserForm="ngForm"
                        (ngSubmit)="getUpdatedUser(updateUserForm.value)">
                        <div class="mb-3">
                            <label for="" class="form-label">User Id</label>
                            <input type="text" formControlName="user_id" class="form-control" id="userId">
                        </div>
                        <div class="mb-3">
                            <label for="" class="form-label">First Name</label>
                            <input type="text" formControlName="first_name" class="form-control" id="firstName">
                        </div>
                        <div class="mb-3">
                            <label for="" class="form-label">Last Name</label>
                            <input type="text" formControlName="last_name" class="form-control" id="lastName">
                        </div>
                        <div class="mb-3">
                            <label for="" class="form-label">Date of Birth (DOB)</label>
                            <input id="dob" class="form-control" type="date" formControlName="dob">
                        </div>
                        <div class="mb-3">
                            <label for="" class="form-label">Gender</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" formControlName="gender" id="male"
                                    value="male" checked>
                                <label class="form-check-label" for="male">
                                    Male
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" formControlName="gender" id="female"
                                    value="female">
                                <label class="form-check-label" for="female">
                                    Female
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" formControlName="gender" id="others"
                                    value="others">
                                <label class="form-check-label" for="others">
                                    Others
                                </label>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="" class="form-label">Country</label>
                            <input type="text" formControlName="country" class="form-control" id="country">
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-primary" data-bs-dismiss="modal">Update</button>
                        </div>
                    </form>
                </div>

            </div>
        </div>
    </div>

    <!-- Modal Select Users to delete -->
    <div class="modal fade" id="deleteUsersModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Alert!</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Please select the users you want to delete. (With checkboxes)
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Okay</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for confirming delete User -->
    <div class="modal fade" id="confirmDeleteUserModal" tabindex="-1" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Alert!</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    {{deleteMessage}}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                    <button type="button" class="btn btn-primary" (click)="confirmDelete()"
                        data-bs-dismiss="modal">Yes</button>
                </div>
            </div>
        </div>
    </div>



    <!-- Snackbar -->
    <!-- <button mat-flat-button color="primary" (click)="openSnackBar()">
        Pizza party
      </button> -->


    <!-- Toast -->
    <!-- <button type="button" class="btn btn-primary" id="liveToastBtn">Show live toast</button>

    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <img src="..." class="rounded me-2" alt="...">
                <strong class="me-auto">Bootstrap</strong>
                <small>11 mins ago</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                Hello, world! This is a toast message.
            </div>
        </div>
    </div> -->



</div>
